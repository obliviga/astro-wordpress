---
import { fetchPages, buildFullPath } from '../lib/wp';

export async function getStaticPaths() {
  const pages = await fetchPages();
  const pageMap = new Map(pages.map((p) => [p.id, p]));

  return pages.map((page) => ({
    params: {
      slug: buildFullPath(page, pageMap),
    },
    props: { page },
  }));
}

const { page } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{page ? page.title.rendered : 'Page not found'}</title>
  </head>
  <body>
    <main>
      {page ? (
        <>
          <h1>{page.title.rendered}</h1>
          <div set:html={page.content.rendered} />
        </>
      ) : (
        <h1>Page not found</h1>
      )}
    </main>
  </body>
</html>